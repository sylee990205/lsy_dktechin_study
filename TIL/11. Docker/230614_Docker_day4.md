# 230614 Docker Day 4
## 목차
<!-- TOC -->

- [Docker Day 4](#docker-day-4)
    - [목차](#%EB%AA%A9%EC%B0%A8)
    - [도커 명령](#%EB%8F%84%EC%BB%A4-%EB%AA%85%EB%A0%B9)
        - [구성](#%EA%B5%AC%EC%84%B1)
        - [버전 확인](#%EB%B2%84%EC%A0%84-%ED%99%95%EC%9D%B8)
        - [컨테이너 제어 명령](#%EC%BB%A8%ED%85%8C%EC%9D%B4%EB%84%88-%EC%A0%9C%EC%96%B4-%EB%AA%85%EB%A0%B9)
        - [이미지 제어 명령](#%EC%9D%B4%EB%AF%B8%EC%A7%80-%EC%A0%9C%EC%96%B4-%EB%AA%85%EB%A0%B9)
        - [볼륨 제어 명령](#%EB%B3%BC%EB%A5%A8-%EC%A0%9C%EC%96%B4-%EB%AA%85%EB%A0%B9)
        - [네트워크 제어 명령](#%EB%84%A4%ED%8A%B8%EC%9B%8C%ED%81%AC-%EC%A0%9C%EC%96%B4-%EB%AA%85%EB%A0%B9)
        - [기타 명령](#%EA%B8%B0%ED%83%80-%EB%AA%85%EB%A0%B9)
        - [단독 명령](#%EB%8B%A8%EB%8F%85-%EB%AA%85%EB%A0%B9)
    - [도커 실행](#%EB%8F%84%EC%BB%A4-%EC%8B%A4%ED%96%89)
        - [docker [container] run 옵션](#docker-container-run-%EC%98%B5%EC%85%98)
        - [도커 컨테이너의 생명주기](#%EB%8F%84%EC%BB%A4-%EC%BB%A8%ED%85%8C%EC%9D%B4%EB%84%88%EC%9D%98-%EC%83%9D%EB%AA%85%EC%A3%BC%EA%B8%B0)
            - [컨테이너 생성 및 실행](#%EC%BB%A8%ED%85%8C%EC%9D%B4%EB%84%88-%EC%83%9D%EC%84%B1-%EB%B0%8F-%EC%8B%A4%ED%96%89)
                - [-d 옵션을 왜 붙이는걸까?](#-d-%EC%98%B5%EC%85%98%EC%9D%84-%EC%99%9C-%EB%B6%99%EC%9D%B4%EB%8A%94%EA%B1%B8%EA%B9%8C)
            - [컨테이너 정지 명령](#%EC%BB%A8%ED%85%8C%EC%9D%B4%EB%84%88-%EC%A0%95%EC%A7%80-%EB%AA%85%EB%A0%B9)
            - [컨테이너 삭제 명령](#%EC%BB%A8%ED%85%8C%EC%9D%B4%EB%84%88-%EC%82%AD%EC%A0%9C-%EB%AA%85%EB%A0%B9)
            - [컨테이너 목록 확인 명령](#%EC%BB%A8%ED%85%8C%EC%9D%B4%EB%84%88-%EB%AA%A9%EB%A1%9D-%ED%99%95%EC%9D%B8-%EB%AA%85%EB%A0%B9)
    - [컨테이너 통신](#%EC%BB%A8%ED%85%8C%EC%9D%B4%EB%84%88-%ED%86%B5%EC%8B%A0)
    - [파일 복사 명령](#%ED%8C%8C%EC%9D%BC-%EB%B3%B5%EC%82%AC-%EB%AA%85%EB%A0%B9)
    - [이미지 삭제](#%EC%9D%B4%EB%AF%B8%EC%A7%80-%EC%82%AD%EC%A0%9C)
    - [도커 네트워크 생성/삭제](#%EB%8F%84%EC%BB%A4-%EB%84%A4%ED%8A%B8%EC%9B%8C%ED%81%AC-%EC%83%9D%EC%84%B1%EC%82%AD%EC%A0%9C)
    - [도커 컨테이너의 저장소](#%EB%8F%84%EC%BB%A4-%EC%BB%A8%ED%85%8C%EC%9D%B4%EB%84%88%EC%9D%98-%EC%A0%80%EC%9E%A5%EC%86%8C)
        - [볼륨 볼륨 마운트](#%EB%B3%BC%EB%A5%A8-%EB%B3%BC%EB%A5%A8-%EB%A7%88%EC%9A%B4%ED%8A%B8)
        - [바인드 마운트](#%EB%B0%94%EC%9D%B8%EB%93%9C-%EB%A7%88%EC%9A%B4%ED%8A%B8)
    - [컨테이너로 이미지 만드는 방법](#%EC%BB%A8%ED%85%8C%EC%9D%B4%EB%84%88%EB%A1%9C-%EC%9D%B4%EB%AF%B8%EC%A7%80-%EB%A7%8C%EB%93%9C%EB%8A%94-%EB%B0%A9%EB%B2%95)

<!-- /TOC -->
---
## 도커 명령
### 구성
```
docker 상위명령 하위명령 [옵션] 대상 [인자]
```
- 상위명령 : container, image
- 하위명령 : run, pull, start
- 옵션 : 명령의 세부 설정시 이용
  - -d: 백그라운드 실행
  - -i or -t : 대화형 실행
- 대상 : 명령을 수행할 구체적인 대상
- 인자 : 대상에 전달할 값 지정

### 버전 확인
```
docker version
```

### 컨테이너 제어 명령
```
docker [container] 하위명령 옵션
```
- 보통 container가 생략되어 docker 하위명령 의 순으로 많이 실행됨

하위 명령 | 내용 | 주요 옵션
----- | --- | ----
start | 컨테이너 실행 | -i
stop | 컨테이너 정지 | 거의 사용하지않음
create | 도커 이미지로부터 컨테이너를 생성 | --name -e -p -v
run | 도커 이미지를 내려받고 컨테이너를 생성해 실행(이미지가 이미 있으면 컨테이너 생성과 실행만 진행) | --name -e -p -v -d -i -t
rm | 정지 상태의 컨테이너를 삭제 | -f -v
exec | 실행 중인 컨테이너 속에서 프로그램 실행 | -f -v
ls | 컨테이너 목록 출력 | -a
cp | 도커 컨테이너와 도커 호스트 간에 파일을 복사 | 거의 사용하지않음
commit | 도커 컨테이너를 이미지로 변환 | 거의 사용하지않음

### 이미지 제어 명령
```
docker image 하위명령 옵션
```

하위 명령 | 내용 | 주요 옵션
----- | --- | ---
pull | 도커 허브 등 리포지토리에서 이미지를 내려받음 | 거의 사용하지않음
rm | 도커 이미지 삭제 | 거의 사용하지않음
ls | 내려 받은 이미지의 목록을 출력 | 거의 사용하지않음
build | 도커 이미지 생성 | -t

### 볼륨 제어 명령
```
docker volume 하위명령 옵션
```

하위 명령 | 내용 | 주요 옵션
---- | --- | ----
create | 볼륨 생성 | --name
inspect | 볼륨의 상세 정보 출력 | 거의 사용하지않음
ls | 볼륨의 목록 출력 | -a
prune | 현재 마운트되지 않은 볼륨을 모두 삭제 | 거의 사용하지않음
rm | 지정한 볼륨 삭제 | 거의 사용하지않음

### 네트워크 제어 명령
```
docker network 하위명령 옵션
```

하위명령 | 내용 
---- | ----- 
connect | 컨테이너를 도커 네트워크에 연결
disconnect | 컨테이너의 도커 네트워크 연결을 해제
create | 도커 네트워크를 생성
inspect | 도커 네트워크의 상세 정보를 출력
ls | 도커 네트워크의 목록을 출력
prune | 현재 컨테이너가 접속하지 않은 네트워크 모두 삭제
rm | 지정한 네트워크를 삭제

### 기타 명령
상위명령 | 내용 
--- | ---- 
checkpoint | 현재 상태를 일시적으로 저장한 후, 나중에 해당 시점의 상태로 되돌림. 실험적 기능
node | 도커 스웜의 노드를 관리
plugin | 플러그인 관리 기능
secret | 도커 스웜의 서비스를 관리하는 기능
stack | 도커 스웜 또는 쿠버네티스에서 여러 개의 서비스를 합쳐 구성한 스택을 관리
swarm | 도커 스웜을 관리
system | 도커 엔진의 정보 확인

### 단독 명령
단독 명령 | 내용 | 주요 옵션
---- | --- | ----
login | 도커 레지스트리에 로그인 | -u -p
logout | 도커 레지스트리에 로그아웃 |
search | 도커 레지스트리 검색
version | 도커 엔진 및 명령행 도구의 버전 출력

---
## 도커 실행
### docker [container] run 옵션
 - 도커 생성 및 실행 기능, 필요시 이미지 다운로드 기능도 수행
 - docker pull + docker create + docker start  
### 도커 컨테이너의 생명주기
![](/TIL/image/2023-06-14-09-41-47.png)
- 동작 중인 컨테이너는 삭제 불가능
- 컨테이너 정지 후 삭제
  ```
  docker stop
  docker rm
  ```
#### 컨테이너 생성 및 실행

옵션 | 내용
--- | ---
--name 컨테이너_이름 | 컨테이너의 이름을 지정
-p 호스트_포트번호:컨테이너_포트번호 | 포트 번호를 지정<br> 호스트 포트번호 : 사용자가 접속하는 포트 <br> 컨테이너 포트번호 : 실제 기동되고있는 포트번호
-v 호스트_디스크:컨테이너_디렉터리 | 볼륨을 마운트함
--net=네트워크이름 | 컨테이너를 네트워크에 연결
-e 환경변수_이름=값 | 환경변수를 설정
-d | 백그라운드로 실행
-i | 컨테이너에 터미널을 연결
-t | 특수 키를 사용 가능하도록 함
-help | 사용 방법 안내 메시지를 출력
##### -d 옵션을 왜 붙이는걸까?
- -d는 백그라운드로 실행한다는 옵션
- -d를 붙이지않으면 foreground로 실행됨
- foreground로 실행되면 해당 터미널(cmd)창에서 다른 명령을 추가로 수행할 수 없음
  - 방금 실행한 컨테이너가 종료될때까지 해당 터미널을 사용할 수 없는것

#### 컨테이너 정지 명령
  - `docker stop 컨테이너명`
#### 컨테이너 삭제 명령
  - `docker rm 컨테이너명`
#### 컨테이너 목록 확인 명령
  - `docker ps [옵션]` or `docker container ls [옵션]`
    - -a 옵션 : all

---
## 컨테이너 통신

---
## 파일 복사 명령
docker cp , docker container cp
```
# 호스트 -> 컨테이너 복사
docker cp 호스트경로 컨테이너이름:컨테이너경로

# 컨테이너 -> 호스트
docker cp 컨테이너이름:컨테이너경로 호스트경로
```
---
## 이미지 삭제
- 컨테이너를 삭제해도 이미지는 남아있기때문에 불필요한 이미지는 즉시 삭제
- 이미지의 컨테이너가 남아있다면 이미지 삭제는 불가능
```
# 이미지 조회
docker image ls
docker image rm 이미지명 [이미지명...]
```
---
## 도커 네트워크 생성/삭제
- 네트워크를 직접 생성하지 않아도 기본 네트워크가 자동으로 세 개 만들어짐
- 네트워크를 명시적으로 지정하지 않고 Docker 컨테이너를 시작하면 기본값인 bridge 네트워크로 Docker 컨테이너 시작
- 컨테이너에 의해 기동된 일부 서버들만의 통신망 구축을 위해 가상의 네트워크를 정의하여 사용
```
# 네트워크 생성
docker network create 네트워크명

# 네트워크 삭제
docker network rm 네트워크명
```
---
## 도커 컨테이너의 저장소
- Docker 컨테이너에 쓰여진 데이터는 컨테이너가 삭제될 때 함께 사라짐
- 데이터를 영속적으로 저장해야하는 경우
- 여러 개의 Docker 컨테이너가 하나의 저장 공간을 공유해서 데이터를 읽거나 써야 하는 경우
- Docker에서 데이터를 영속적으로 저장할 수 있는 두 가지 방법
  - Docker 볼륨(volumne)
  - 바인드 마운트
### 볼륨 `(볼륨 마운트)`
  - 도커 엔진이 관리하는 영역 내에 만들어진 볼륨을 컨테이너에 디스크 형태로 마운트하여 사용
  - 직접 조작이 어려움
    - 자주 쓰지는 않지만 지우면 안되는 파일 저장
  - 도커 엔진에 의해 관리
    - 리눅스 `/var/lib/docker/volumns`
    - 도커 데스크탑 도커 엔진의 관리영역
  - 운영체제와 무관하게 일관성있는 방식으로 작업
  - 도커 제작사에서 추천하는 방식
  - 컨테이너 없이 접근 불가능
  - 백업 절차 복잡
### 바인드 마운트
- 도커 엔진에서 관리하지 않는 영역의 디렉터리를 컨테이너에 마운트
- 디렉터리 직접 조회 가능
- 자주 사용하는 파일을 보관하는 용도로 사용
- 기존에 사용하는 방식으로 파일 사용 가능
  - 도커 엔진과 무관하게 파일 제어
  - 파일 자주 편집해야 하는 경우 좋음

---
## 컨테이너로 이미지 만드는 방법
- 나만의 이미지로 동일한 구성의 컨테이너를 대량으로 생성 가능
- 다른 서버로 쉽게 이동 가능
1. commit
    ```
    docker commit 컨테이너이름 새로운이미지이름:[태그]
    ```
2. push
   ```
   docker push 이미지이름:[태그]
   ```
  
  